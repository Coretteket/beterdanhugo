var Rts = [
    1.7355679702048417, 1.929383116883117, 1.8795345653661877, 2.0273573923166475, 1.999517141477547, 1.915492957746479, 2.1394557823129254, 2.236842105263158, 2.1914279369309346, 2.221305595408895, 2.2676563851253966, 2.246981717833736, 2.1894901527701087, 2.1478700468366667, 2.101940867041538, 1.9963337296868806, 1.968768074031232, 1.833333333333333, 1.877580683436165, 1.8978273486588102, 1.6670232110386136, 1.479228402634907, 1.4993196575896937, 1.4396542274143789, 1.4227602487333026, 1.506529875507658, 1.5052483158389471, 1.460028019788976, 1.491229828605793, 1.4375661665388966, 1.4435595538808839, 1.4158573058304813, 1.3590540982906592, 1.265216150000332, 1.1776459313249519, 1.0918794181579057, 1.0289079549191353, 0.9325593560889777, 0.8913547811729826, 0.8571578162824073, 0.7872981250277411, 0.7663245033112582, 0.753409335639802, 0.7479246441203122, 0.7218053791988918, 0.7476673593285253, 0.7633494104117677, 0.7336654445215167, 0.7162064437551147, 0.7120418848167541, 0.7390280453864269, 0.7212685218648356, 0.7149196249162761, 0.735353432858538, 0.7306074891519793, 0.7132847335267889, 0.7141634381475811, 0.7322694188287386, 0.6969289019772823, 0.6958243018110813, 0.7179888225532647, 0.7195269860521527, 0.7053217689260091, 0.707006804269167, 0.7307097273254689, 0.7249616760347469, 0.7454511044421015, 0.7785152689152234, 0.8056573966437154, 0.7732981857652348, 0.7714647695156417, 0.7754970043572986, 0.802188402181274, 0.8190893234868448, 0.8400200215616818, 0.871723479575196, 0.9552988242978445, 0.9301808295917949, 0.934831648425098, 0.8931262168797087, 0.9070109424332857, 0.9244193733198184, 0.8391354931090031, 0.8492764344167552, 0.8121752395480766, 0.8226757144979939, 0.7781543675858883, 0.8232038261056478, 0.8373349674112864, 0.7581620314389359, 0.7625098323954741, 0.7471731673230847, 0.7738525357955308, 0.7186405045550105, 0.7048340387614168, 0.7084122474747475, 0.7217799379870946, 0.6410506699795901, 0.6481835564053536, 0.7197655285890581, 0.7211025166140103, 0.6769355024806737, 0.658936721351918, 0.7028064601535611, 0.6291344123856438, 0.5941015506232897, 0.5689940436796824, 0.5844649646931016, 0.6800947867298579, 0.818565400843882, 0.851138353765324, 0.9199007220216608, 1.0126117862875486, 0.989707227813358, 0.9472839789135916, 0.9085012740328933, 0.9115148655025955, 1.098486668268076, 0.9941107184923438, 0.9964622641509435, 1.1357092282275194, 1.1688878676470589, 1.1500333407423873, 1.1068191627104016, 0.9587999154870058, 0.9456753302087773, 0.9256945940124919, 0.8174464363795366, 0.853641933287951, 0.9240299205236091, 0.9287918347970567, 0.7856970864435348, 0.9132075471698112, 0.9193548387096775, 0.8568826437678896, 0.8178408786498793, 0.8401445649152073, 0.8506605399195865, 0.9348727057430433, 1.1574685062987402, 1.10758941552777, 1.1651010532308566, 1.1129787820336183, 1.1845863648612232, 1.1858108108108107, 1.1779002756201455, 1.0435518993467214, 1.0599664188054692, 1.0616259777198387, 1.3605712947787403, 1.4007425202009176, 1.350788515972503, 1.4128093708671832, 1.1457242582897034, 1.2424961845005935, 1.2967814976548602, 1.2816793893129768, 1.195114900997254, 1.2232577549033248, 1.2716378162450064, 1.2595352361707501, 1.3697922919918357, 1.3856903297931804, 1.1141670991177994, 1.0801623541349565, 1.0988714670927797, 1.1361277054157282, 1.1763752502621792, 1.085182797679344, 1.0452734516479536, 1.0744795405599425, 1.1321839080459772, 1.1214574898785425, 1.142124295685813, 1.0613296262981435, 1.0949188141206883, 1.0190264785159346, 0.9968409413994628, 1.034771613718982, 0.9890127138596765, 0.8949976403964133, 0.8674379368522536, 0.8828092762234876, 0.8453477562748246, 0.868753815296067, 0.8517821959519972, 0.8795569912321181, 1.0184414601853602, 1.1008197493639875, 1.1302299806040454, 1.2371950670627416, 1.3003609487796495, 1.3376570733684638, 1.398693803159174, 1.5109720073146713, 1.5229404632761152, 1.5300404390525708, 1.6168712457560719, 1.5914353466313294, 1.6263772816099122, 1.6262932308601832, 1.478098115190123, 1.4552538512257984, 1.5039281397648612, 1.5053277768073268, 1.477302087346735, 1.4716044274335365, 1.5016637047680268, 1.3896840260476622, 1.379680252482586, 1.3866609383564685, 1.3240466990277913, 1.2378800010331379, 1.1950245321630215, 1.2097126314040956, 1.2248995069291821, 1.2033955561367375, 1.14282722513089, 1.1290874292462436, 1.1272775991425512, 1.137279950449535, 1.1140195542829152, 1.1086686251577076, 1.1210938556247576, 1.0992660647341466, 1.1299939597894553, 1.1580700234645047, 1.1968009652541127, 1.1900541218919132, 1.1508281948978358, 1.122351974649375, 1.0993455722304961, 1.098322790808697, 1.065581107133021, 1.0757755955010364, 1.0949623430962343, 1.0660263316952672, 1.0241210722205651, 1.0332653614341212, 1.051186881799009, 1.028935111742833, 0.99195614046156, 0.9782623806484634, 0.9728045289820579, 0.964934335634883, 0.9689602652836955, 0.9661473994606863, 0.9594710730887926, 0.9565143190962855, 0.9561328000847549, 0.9488306535113794, 0.9421261144519358, 0.9363614016879251, 0.9404169087337816, 0.9236691981940992, 0.9174035426914219, 0.942107545533391, 0.9163485865543515, 0.9055551424109467, 0.8952853786098687, 0.8997421942136923, 0.8896323976709829, 0.8940888490341968, 0.9379338235900991, 0.9175560142741335, 0.9180432344243907, 0.9215152693188199, 0.9340430760589093, 0.919686930226353, 0.9593235046868362, 0.9884260314046426, 0.9659739666590543, 0.9588889910788191, 0.9432471530843133, 0.9765035830863316, 0.9570732534798465, 0.9773288973384029, 0.9880160041251685, 0.9724328049620949, 0.9703549703549702, 0.9807319907048798, 1.002235570848156, 0.9741566920565833, 0.980760967225282, 0.9920099605890078, 0.9967104940150632, 1.0126753920528238, 1.053856708811134, 1.0487253827730318, 1.0510880212034497, 1.0633567178083232, 1.0918042635476999, 1.097845824845373, 1.0835367507458635, 1.1241352327091003, 1.1423427331887201, 1.1570897064902852, 1.2031818739519855, 1.2255881405091849, 1.2051698592841618, 1.203909867864961, 1.1630872390048868, 1.1614984908881916, 1.1227143675765785, 1.1173595530612634, 1.094796000745203, 1.0401930730179239, 1.0287179115125573, 0.9854525343849186, 0.9594557117708055, 0.9201327473970204, 0.8936347632724914, 0.8888299852951385, 0.8497043788082207, 0.8425843975218107, 0.8434451010031604, 0.829163799890767, 0.8396809776302453, 0.8665781487101669, 0.9193190056359769, 0.9235815644981105, 0.9365163657429759, 0.9618600557429955, 0.963127207029646, 0.9665348467800647, 0.9867153077967399, 1.010397180652058, 0.9632061870275768, 0.938838048862396, 0.9405880003059847, 0.9698937680099781, 0.9769806585608585, 0.9767003121114908, 0.9884266335915868, 0.9759240776733028, 0.9464248011823492, 0.9538922581677842, 0.9474047946004649, 0.9307451585105901, 0.9351073419304993, 0.9541036465468237, 0.9399936043340045, 0.9544009291167679, 0.9564310967642765, 0.9616208410463165, 0.9363701178837573, 0.9272896345685849, 0.944737793125602, 0.9227528802720396, 0.9273658923839866, 0.9349786575159019, 0.9659744967723469, 0.9812164484146042, 1.0048207226798933, 1.041097209884735, 1.0442120906533625, 1.0269365937835393, 1.0352694924123496, 1.0187063518456931, 0.9853495402965294, 1.001090331356891, 1.0119910300865846, 0.994044721551894, 0.981283311557685, 0.9705965007233781, 0.971417204120948, 0.9861002885243139, 0.9959874131486137, 1.011730391224399, 0.9879280533063429, 0.9892727676259526, 0.9689141670903237, 0.9928060620916775, 1.0228403099451406, 1.030864197530864, 1.0574427420461863, 1.049326137111002, 1.0471902911015547, 1.0675890178086822, 1.0717396356434843, 1.038400621582046, 1.038898774219059, 1.0406583813157817, 1.0387736436522148, 1.0489027063037666, 1.0749622320387051, 1.0886919004465212, 1.0768718124346288, 1.0943499425696002, 1.107902082885978, 1.0992730775967767, 1.0915437924549367, 1.1008188633737848, 1.0867157146399935, 1.0917379009978223, 1.1137832532754575, 1.1439404578008707, 1.1227363727363726, 1.1057695866178157, 1.105100642926002, 1.0987484293249468, 1.0635594695255666, 1.0739666325246955, 1.0967328939257432, 1.0465181188072754, 1.0354558563066651, 1.0386712518632808, 1.0465164559261446, 1.0287003528889973, 1.0450257563943606, 1.0626761678543148, 1.0635267181302939, 1.0448466503999754, 1.0305503345843257, 1.0491678583381505, 1.041819573247525, 1.0530958114964235, 1.0591310106672345, 1.055430234460834, 1.0708906267159115, 1.055594816089727, 1.0555189187056482, 1.0527072753321032, 1.04446209688986, 1.0494286182951502, 1.0142665323934206, 0.9963827777027939, 0.9854666083169901, 0.9762669802170649, 0.9459104841651377, 0.942567009741868, 0.9426791311949131, 0.9098533321317532, 0.9097181991820721, 0.878968427816233, 0.872494028769657, 0.8561959813503204, 0.8799246089722913, 0.884001244232464, 0.879753469734363, 0.8786597510655509, 0.8938949539143216, 0.919140727875807, 0.8915489187448905, 0.8988322819680374, 0.9121032569724875, 0.8801438274071115, 0.8620076198872759, 0.847931676515826, 0.8563950139012968
];

var ans = 0;
var foundLin = false

function lin(y1, y2, x1, x2) {
    if (foundLin) {
        return;
    }
    if (x2 == -1) {
        x2 = 999999;
    }
    if (day >= x1 && day < x2 && y1 == y2) {
        ans = y1;
        foundLin = true;
    } else if (day >= x1 && day < x2) {
        ans = (y2 - y1) / (x2 - x1) * (day - x1) + y1;
        foundLin = true;
    }
}

var a = { //geselecteerde acties
    foo: -1,
    bar: -1
}

var c = { //gemaakte keuzes
    jan11_warning: false
}

var delay = 4;
var e = { //coefficients for effectiveness of selected measures
    foo: function() {
        if (a.foo > 0) {
            foundLin = false;
            lin(1, 2, a.foo, a.foo + delay);
            lin(2, 2, a.foo + delay, -1);
            return ans;
        } else {
            foundLin = false;
            lin(2, 1, -a.foo, -a.foo + delay);
            lin(1, 1, -a.foo + delay, -1);
            return ans;
        }
    },
    bar: function() {
        if (a.bar > 0) {
            foundLin = false;
            lin(1, .5, a.bar, a.bar + delay);
            lin(.5, .5, a.bar + delay, -1);
            return ans;
        } else {
            foundLin = false;
            lin(.5, 1, -a.bar, -a.bar + delay);
            lin(1, 1, -a.bar + delay, -1);
            return ans;
        }
    }
}

var r = { //changes in covid dynamic rates, like undercounting
    death: function() {
        foundLin = false;
        lin(1, 1, 0, 120);
        lin(1, 0.55, 120, 180);
        lin(0.55, 0.55, 180, -1);
        return ans;
    },
    underdeath: function() {
        foundLin = false;
        lin(0, 0.2, 0, 30)
        lin(0.2, 0.6, 30, 45);
        lin(0.6, 0.6, 45, -1)
        var wday = new Date((epoch + day * 60 * 60 * 24) * 1000).getDay();
        var weff = [0.518, 0.549, 1.407, 1.238, 1.062, 1.101, 1.128];
        return weff[wday] * ans;
    },
    test: function() {
        foundLin = false;
        lin(0, 0.015, 0, 20);
        lin(0.015, 0.033, 20, 30);
        lin(0.033, 0.033, 30, 80);
        lin(0.033, 0.1, 80, 130);
        lin(0.1, 0.35, 130, 150);
        lin(0.35, 0.35, 150, -1);
        return ans;
    },
    testday: function() {
        var wday = new Date((epoch + day * 60 * 60 * 24) * 1000).getDay();
        var weff = [
            1.008,
            0.901,
            0.863,
            0.988,
            1.088,
            1.092,
            1.048
        ];
        return weff[wday];
    }
}

var v = [ // age specific info for vax
    { perc: 0.10185, aifr: 0.00048, vax: 0 }, // 0 - 9
    { perc: 0.11503, aifr: 0.00161, vax: 0 }, // 10 - 19
    { perc: 0.12831, aifr: 0.00538, vax: 0 }, // 20 - 29
    { perc: 0.12339, aifr: 0.01788, vax: 0 }, // 30 - 39
    { perc: 0.12685, aifr: 0.06265, vax: 0 }, // 40 - 49
    { perc: 0.14548, aifr: 0.22048, vax: 0 }, // 50 - 59
    { perc: 0.12143, aifr: 0.87891, vax: 0 }, // 60 - 69
    { perc: 0.09044, aifr: 2.81399, vax: 0 }, // 70 - 79
    { perc: 0.03977, aifr: 10.0284, vax: 0 }, // 80 - 89
    { perc: 0.00746, aifr: 26.3875, vax: 0 }, // 90+
]

var s = { // spread info
    a: 0,
    b: 1 / 5,
    c: 1 / 270,

    N: 17500000, //population
    S: 17500000 - 1000, //susceptible
    I: 1000, //infectious
    R: 0, //removed
    F: 0, //real fatalities

    Ss: [17500000 - 1000],
    Is: [1000],
    Rs: [0],
    Fs: [0],

    dSs: [0],
    dIs: [0],
    dRs: [0],
    dFs: [0],

    P: 0, //positive tests
    H: 0, //hospitalisations
    D: 0, //counted deaths

    Ps: [0],
    Hs: [0],
    Ds: [0],
}

var b = { //preset constant beginning values
    Ps: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 3, 5, 4, 10],
    Hs: [],
    Ds: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 3, 3, 7, 4]
}

function calcIFR() {
    var ifr = 0.01;
    return ifr * r.death();

}

function calcR() {
    //return 2 * e.foo() * e.bar();
    return Rts[day] * s.N / s.S;
}

function calcCOV() {
    s.a = calcR() * s.b;

    var dS = s.R * s.c;
    var dI = s.a * s.S * s.I / s.N;
    var dR = s.b * s.I * (1 - calcIFR());
    var dF = s.b * s.I * calcIFR();

    s.dSs.push(dS);
    s.dIs.push(dI);
    s.dRs.push(dR);
    s.dFs.push(dF);

    s.S += dS - dI;
    s.I += dI - dR - dF;
    s.R += dR - dS;
    s.F += dF;

    s.Ss.push(s.S);
    s.Is.push(s.I);
    s.Rs.push(s.R);
    s.Fs.push(s.F);

    if (day + 1 < b.Ps.length) { s.P = b.Ps[day] } else {
        s.P = Math.round(s.dIs[day - 7] * r.test() * r.testday() * randBetween(0.85, 1.15));
    };
    s.H = 0;
    if (day + 1 < b.Ds.length) { s.D = b.Ds[day] } else {
        s.D = Math.round(s.dFs[day - 7] * r.underdeath()); // * randBetween(0.85, 1.15));
    };

    s.Ps.push(s.P);
    s.Hs.push(s.H);
    s.Ds.push(s.D);
}